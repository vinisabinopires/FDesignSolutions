<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sign in ¬∑ F/Design Solutions</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet" />
  <style>
    :root {
      color-scheme: light;
      --primary: #2b5797;
      --accent: #fbbc04;
      --surface: rgba(255, 255, 255, 0.92);
      --error: #dc2626;
      --success: #16a34a;
    }
    *, *::before, *::after {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 24px;
      font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: radial-gradient(circle at top right, #fbbc04, #2b5797 55%, #0f172a);
    }
    .card {
      width: min(420px, 100%);
      background: var(--surface);
      padding: 36px;
      border-radius: 20px;
      box-shadow: 0 24px 60px rgba(15, 23, 42, 0.18);
      position: relative;
      overflow: hidden;
    }
    .card::before {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(135deg, rgba(43, 87, 151, 0.12), rgba(251, 188, 4, 0.12));
      z-index: 0;
    }
    .card-content {
      position: relative;
      z-index: 1;
    }
    h1 {
      margin: 0;
      font-size: 1.75rem;
      color: var(--primary);
    }
    p.subtitle {
      margin: 6px 0 24px;
      color: #4b5563;
      font-size: 0.95rem;
    }
    .form-group {
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-bottom: 18px;
    }
    label {
      font-weight: 500;
      color: #1f2937;
      font-size: 0.9rem;
    }
    input {
      padding: 12px 14px;
      border-radius: 10px;
      border: 1.5px solid rgba(148, 163, 184, 0.5);
      font-size: 1rem;
      transition: border-color 0.2s ease, box-shadow 0.2s ease;
    }
    input:focus {
      border-color: var(--primary);
      outline: none;
      box-shadow: 0 0 0 4px rgba(43, 87, 151, 0.12);
    }
    button.primary {
      width: 100%;
      border: none;
      border-radius: 12px;
      padding: 14px;
      font-weight: 600;
      font-size: 1rem;
      background: linear-gradient(135deg, var(--accent), #ffd250);
      color: #111827;
      cursor: pointer;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    button.primary:disabled {
      cursor: not-allowed;
      opacity: 0.65;
    }
    button.primary:not(:disabled):hover {
      transform: translateY(-2px);
      box-shadow: 0 16px 30px rgba(251, 188, 4, 0.28);
    }
    .link-button {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      margin-top: 14px;
      font-size: 0.9rem;
      color: var(--primary);
      background: none;
      border: none;
      cursor: pointer;
    }
    .message {
      display: none;
      padding: 12px 14px;
      border-radius: 12px;
      font-size: 0.9rem;
      margin-bottom: 18px;
      border-left: 4px solid transparent;
    }
    .message.error {
      background: #fef2f2;
      color: var(--error);
      border-color: var(--error);
    }
    .message.success {
      background: #f0fdf4;
      color: var(--success);
      border-color: var(--success);
    }
    .spinner {
      width: 16px;
      height: 16px;
      border-radius: 50%;
      border: 2px solid rgba(17, 24, 39, 0.15);
      border-top-color: rgba(17, 24, 39, 0.8);
      animation: spin 0.8s linear infinite;
    }
    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
    .footer-note {
      margin-top: 32px;
      text-align: center;
      font-size: 0.85rem;
      color: rgba(17, 24, 39, 0.6);
    }
  </style>
</head>
<body>
  <div class="card">
    <div class="card-content">
      <h1>Welcome back</h1>
      <p class="subtitle">Sign in to access the F/Design Solutions workspace.</p>

      <div id="errorMessage" class="message error"></div>
      <div id="successMessage" class="message success"></div>

      <form id="loginForm">
        <div class="form-group">
          <label for="email">Corporate e-mail</label>
          <input id="email" name="email" type="email" autocomplete="email" placeholder="you@fdesignsolutions.com" required />
        </div>
        <div class="form-group">
          <label for="pin">Secure PIN</label>
          <input id="pin" name="pin" type="password" inputmode="numeric" placeholder="Enter your PIN" required />
        </div>
        <button id="loginBtn" class="primary" type="submit">
          <span id="spinner" class="spinner" style="display:none"></span>
          <span id="btnText">Sign in</span>
        </button>
      </form>

      <button id="autoLoginBtn" class="link-button" type="button">
        <span>üîÅ Sign in with Google account</span>
      </button>

      <p class="footer-note">Secure environment ‚Äî Newark, NJ ¬∑ F/Design Solutions</p>
    </div>
  </div>

  <script>
    const loginForm = document.getElementById('loginForm');
    const loginBtn = document.getElementById('loginBtn');
    const spinner = document.getElementById('spinner');
    const btnText = document.getElementById('btnText');
    const autoLoginBtn = document.getElementById('autoLoginBtn');

    loginForm.addEventListener('submit', handleLogin);
    autoLoginBtn.addEventListener('click', attemptAutoLogin);
    document.addEventListener('DOMContentLoaded', () => setTimeout(attemptAutoLogin, 500));

    function handleLogin(event) {
      event.preventDefault();
      const email = document.getElementById('email').value.trim();
      const pin = document.getElementById('pin').value.trim();
      if (!email || !pin) {
        showError('Please enter both e-mail and PIN.');
        return;
      }
      setLoadingState(true);
      hideMessages();
      google.script.run
        .withSuccessHandler(onLoginSuccess)
        .withFailureHandler(onLoginError)
        .loginManual(email, pin);
    }

    function attemptAutoLogin() {
      hideMessages();
      google.script.run
        .withSuccessHandler(onAutoLoginSuccess)
        .withFailureHandler(() => {})
        .loginAutomatico();
    }

    function onLoginSuccess(result) {
      setLoadingState(false);
      if (!result || !result.success) {
        showError(result?.message || 'Unable to authenticate.');
        return;
      }
      showSuccess('Authentication successful. Loading workspace...');
      openWorkspace();
    }

    function onLoginError(error) {
      setLoadingState(false);
      showError('Connection error. Please try again.');
      console.error('Login error', error);
    }

    function onAutoLoginSuccess(result) {
      if (result && result.success) {
        showSuccess('Signed in with your Google Workspace account.');
        openWorkspace();
      } else if (result && result.type === 'unregistered') {
        showError('Your Google account is not registered. Use manual sign in.');
      }
    }

    function openWorkspace() {
      google.script.run
        .withSuccessHandler(() => google.script.host.close())
        .withFailureHandler((err) => showError('Unable to open the workspace.'))
        .iniciarSistemaFDesign();
    }

    function setLoadingState(loading) {
      loginBtn.disabled = loading;
      spinner.style.display = loading ? 'inline-block' : 'none';
      btnText.textContent = loading ? 'Signing in...' : 'Sign in';
    }

    function showError(message) {
      const el = document.getElementById('errorMessage');
      el.textContent = message;
      el.style.display = 'block';
      document.getElementById('successMessage').style.display = 'none';
    }

    function showSuccess(message) {
      const el = document.getElementById('successMessage');
      el.textContent = message;
      el.style.display = 'block';
      document.getElementById('errorMessage').style.display = 'none';
    }

    function hideMessages() {
      document.getElementById('errorMessage').style.display = 'none';
      document.getElementById('successMessage').style.display = 'none';
    }
  </script>
</body>
</html>
